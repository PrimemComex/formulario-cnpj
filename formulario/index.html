// ... (código anterior permanece igual)

document.getElementById("cnpj-form").addEventListener("submit", async function(event) {
    event.preventDefault();
    // ... (código anterior permanece igual até a verificação do CNPJ)

    try {
        // ... (código anterior de busca permanece igual)

        if (matchingCompanies.length > 0) {
            // ... (código existente para empresas encontradas)
        } else {
            // Cria nova empresa se não encontrada
            showStatusMessage("Nenhuma empresa encontrada. Criando nova empresa...");
            const newCompany = await createCompany(cnpjFormatted);
            companyId = newCompany.ID;
            
            // Atualiza a exibição com dados básicos
            document.getElementById("razao_social").textContent = cnpjFormatted;
            document.getElementById("email").textContent = "Não informado";
            document.getElementById("telefone").textContent = "Não informado";
            resultDiv.style.display = "block";
            createDealBtn.style.display = "block";
        }
    } catch (error) {
        console.error("Erro na busca:", error);
        showStatusMessage("Erro ao processar empresa: " + error.message, true);
    }
});

// Nova função para criar empresa
async function createCompany(cnpj) {
    const companyAddWebhook = "https://primem.bitrix24.com.br/rest/89/2h0usfzkv0bo8jqo/crm.company.add";
    
    const companyData = {
        fields: {
            TITLE: cnpj,  // Usa o CNPJ como razão social temporária
            UF_CRM_25C6A52B: cnpj  // Campo customizado do CNPJ
        }
    };

    try {
        const response = await fetch(companyAddWebhook, {
            method: "POST",
            headers: { "Content-Type": "application/json" },
            body: JSON.stringify(companyData)
        });
        
        if (!response.ok) throw new Error("Erro ao criar empresa: " + response.statusText);
        const data = await response.json();
        
        if (!data.result) {
            throw new Error("Falha ao criar empresa: " + (data.error_description || "Erro desconhecido"));
        }
        
        return { ID: data.result };
    } catch (error) {
        console.error("Erro na criação da empresa:", error);
        throw error;
    }
}

// ... (o restante do código permanece igual)
